<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>PoolGame</title>
    <link rel="stylesheet" href="style.css">

    <script type="importmap">
        {
          "imports": {
            "three": "https://threejs.org/build/three.module.js",
            "three/addons/": "https://threejs.org/examples/jsm/"
          }
        }
    </script>

    <script type="module">
        import * as THREE from 'three';
        import { PointerLockControls } from 'three/addons/controls/PointerLockControls.js';

        // Configuração básica da cena
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ antialias: true });

        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.shadowMap.enabled = true;
        document.body.appendChild(renderer.domElement);

        // Adicionar controle de cursor bloqueado
        const controls = new PointerLockControls(camera, document.body);

        // Evento para ativar o controle ao clicar na tela
        document.addEventListener('click', () => {
            controls.lock();
        });

        // Iluminação
        const luz = new THREE.SpotLight(0xffffff, 200);
        luz.position.set(0, 10, 0);
        luz.castShadow = true;
        scene.add(luz);

        const ambientLight = new THREE.AmbientLight(0xffffff, 0.4);
        scene.add(ambientLight);

        // Fundo da cena
        scene.background = new THREE.Color(0xaaaaaa);

        // Chão
        const geometryChao = new THREE.PlaneGeometry(50, 50);
        const materialChao = new THREE.MeshStandardMaterial({ color: 0x888888, roughness: 0.8 });
        const chao = new THREE.Mesh(geometryChao, materialChao);
        chao.rotation.x = -Math.PI / 2;
        chao.receiveShadow = true;
        scene.add(chao);

        // Mesa de bilhar
        const geometryMesa = new THREE.BoxGeometry(10, 0.2, 5);
        const materialMesa = new THREE.MeshStandardMaterial({ color: 0x006600, roughness: 0.4, metalness: 0.1 });
        const mesa = new THREE.Mesh(geometryMesa, materialMesa);
        mesa.position.set(0, 0.8, 0);
        mesa.receiveShadow = true;
        scene.add(mesa);

        // Bolas
        const geometryBola = new THREE.SphereGeometry(0.1, 32, 32);
        const materialBola1 = new THREE.MeshStandardMaterial({ color: 0xffffff, roughness: 0.2, metalness: 0.8 });
        const bola1 = new THREE.Mesh(geometryBola, materialBola1);
        bola1.castShadow = true;
        bola1.position.set(0, 0.95, 0);
        scene.add(bola1);

        const materialBola2 = new THREE.MeshStandardMaterial({ color: 0xf0ff00, roughness: 0.2, metalness: 0.8 });
        const bola2 = new THREE.Mesh(geometryBola, materialBola2);
        bola2.castShadow = true;
        bola2.position.set(0.5, 0.95, 0.4);
        scene.add(bola2);

        // Pernas da mesa
        const geometryPerna = new THREE.CylinderGeometry(0.1, 0.1, 0.75, 16);
        const materialPerna = new THREE.MeshStandardMaterial({ color: 0x552200 });

        const posicoesPernas = [
            [-4.5, 0.375, -2], [4.5, 0.375, -2],
            [-4.5, 0.375, 2], [4.5, 0.375, 2]
        ];

        posicoesPernas.forEach(pos => {
            const perna = new THREE.Mesh(geometryPerna, materialPerna);
            perna.castShadow = true;
            perna.position.set(pos[0], pos[1], pos[2]);
            scene.add(perna);
        });

        // Definir posição inicial da câmara
        camera.position.set(0, 2, 5);

        // Configuração para movimento FPS
        const keys = { w: false, a: false, s: false, d: false };
        const speed = 0.1;

        document.addEventListener('keydown', (event) => {
            if (keys.hasOwnProperty(event.key.toLowerCase())) {
                keys[event.key.toLowerCase()] = true;
            }
        });

        document.addEventListener('keyup', (event) => {
            if (keys.hasOwnProperty(event.key.toLowerCase())) {
                keys[event.key.toLowerCase()] = false;
            }
        });

        function updateCameraPosition() {
            if (controls.isLocked) {
                const direction = new THREE.Vector3();
                camera.getWorldDirection(direction);
                direction.y = 0;
                direction.normalize();

                const right = new THREE.Vector3();
                right.crossVectors(camera.up, direction).normalize();

                if (keys.w) camera.position.addScaledVector(direction, speed);
                if (keys.s) camera.position.addScaledVector(direction, -speed);
                if (keys.d) camera.position.addScaledVector(right, -speed);
                if (keys.a) camera.position.addScaledVector(right, speed);

                camera.position.y = 2; // Mantém a altura fixa
            }
        }

        function animate() {
            requestAnimationFrame(animate);
            updateCameraPosition();
            renderer.render(scene, camera);
        }

        animate();
    </script>
</head>
<body>
    <div id="Tag3DScene"></div>
</body>
</html>
